---
export interface Props {
  title: string;
}

import { NeoThemeProvider } from "@avaya/neo-react";

import { SiteHeader, SiteFooter, LeftNavigation } from "components";

import type { PageAstroInstance } from "helpers/types";

import "@avaya/neo-react/avaya-neo-react.css";

const userAgentString = Astro.request.headers.get("user-agent");

const userAgent = userAgentString?.toLowerCase().includes("mac")
  ? "macos"
  : "windows";

const { title } = Astro.props as Props;

const pages = (await Astro.glob<PageAstroInstance>("../**/*.astro"))
  .filter((page) => page.title)
  .map((page) => ({
    ...page,
    title: page.title,
    keywords: page.keywords,
  }));
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
  </head>

  <body id="body-content-wrapper">
    <NeoThemeProvider initialMode="dynamic">
      <SiteHeader
        pathname={Astro.url.pathname}
        pages={pages}
        userAgent={userAgent}
        client:load
      />

      <div class="main__wrapper">
        <LeftNavigation pages={pages} />
        <p>{userAgentString}</p>
        <p>{userAgent}</p>

        <main id="main-content">
          <slot />
        </main>
      </div>

      <SiteFooter />
    </NeoThemeProvider>

    <style is:global>
      :root {
        --header-height: 58px;
        --footer-height: 58px;

        /*
        --mobile-small-max-breakpoint: 671px;
        --mobile-max-breakpoint: 799px;
        --tablet-max-breakpoint: 1279px;
        */
      }

      body {
        font-size: 1rem;
        color: var(--global-font-color);
      }

      /* mobile */
      @media screen and (max-width: 799px) {
        :root {
          --header-height: 48px;
          --footer-height: 48px;
        }
      }

      a {
        text-decoration: none;
      }
    </style>

    <style>
      body {
        margin: 0;
      }

      body main {
        /* plus `1px` for border */
        --body-main-height: calc(
          100vh - var(--header-height) - var(--footer-height) - 1px
        );

        min-height: var(--body-main-height);
        max-width: 60rem;
        padding: 0 1rem 2rem 1rem;
        margin: auto;
      }

      .main__wrapper {
        display: flex;
      }

      @media screen and (max-width: 799px) {
        body main {
          --body-main-height: calc(
            100vh - var(--header-height) - (var(--footer-height) * 3) - 1px
          );
        }

        .main__wrapper {
          display: block;
          position: relative;
          overflow-x: hidden;
        }
      }
    </style>
  </body>
</html>

<script>
  const leftNavigationElement = document.getElementById("left-navigation");

  const elem = document.getElementById("body-content-wrapper");

  const leftNavScrim = document.getElementById("left-navigation-scrim");

  const closeOnClickAway = (event: MouseEvent) => {
    if (
      leftNavigationElement?.classList.contains("left-navigation--active") &&
      event.target != leftNavigationElement
    ) {
      leftNavigationElement.classList.remove("left-navigation--active");
      leftNavigationElement.classList.add("left-navigation--hidden");
    }
  };

  const toggleLeftNavigation = () => {
    if (leftNavigationElement?.classList.contains("left-navigation--active")) {
      leftNavigationElement.classList.remove("left-navigation--active");
      leftNavigationElement.classList.add("left-navigation--hidden");
    } else if (
      leftNavigationElement?.classList.contains("left-navigation--hidden")
    ) {
      leftNavigationElement.classList.add("left-navigation--active");
      leftNavigationElement.classList.remove("left-navigation--hidden");
    } else {
      leftNavigationElement?.classList.add("left-navigation--active");
    }
  };

  leftNavScrim?.addEventListener("click", closeOnClickAway);
  elem?.addEventListener("toggleLeftNavigation", toggleLeftNavigation);
</script>
